# ğŸ·ï¸æ¥å£å­¦ä¹ :execle

å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š
##### ğŸ“„ myprocess.c
```c
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <stdlib.h>

int main()

{

Â  Â  pid_t id = fork(); // åˆ›å»ºå­è¿›ç¨‹

Â  Â  if (id == 0) Â  Â  Â  // è¿™é‡Œæ˜¯å­è¿›ç¨‹

Â  Â  {

Â  Â  Â  Â  printf("pid: %d, exec command begin\n", getpid());

Â  Â  Â  Â  execl("./mytest", "mytest", NULL);

Â  Â  Â  Â  printf("pid: %d, exec command end\n", getpid());

Â  Â  Â  Â  exit(1);

Â  Â  }

Â  Â  else

Â  Â  {

Â  Â  Â  Â  // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹

Â  Â  Â  Â  pid_t rid = waitpid(-1, NULL, 0);

Â  Â  Â  Â  if (rid > 0)

Â  Â  Â  Â  {

Â  Â  Â  Â  Â  Â  printf("wait sucess, rid: %d\n", rid);

Â  Â  Â  Â  }

Â  Â  }

Â  Â  return 0;

}
```


##### ğŸ“„ test.cc 
```c++
#include <iostream>
int main()

{

Â  Â  std::cout << "hello c++" << std::endl;

Â  Â  std::cout << "hello c++" << std::endl;

Â  Â  std::cout << "hello c++" << std::endl;

Â  Â  std::cout << "hello c++" << std::endl;

Â  Â  std::cout << "hello c++" << std::endl;

Â  Â  return 0;

}
```


ä¸Šé¢çš„``myprocess.c``æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨çš„``execl`` è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œç¨‹åºæ›¿æ¢çš„ã€‚

ç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢ğŸ‘†ğŸ»çš„ä»£ç ï¼Œæˆ‘æƒ³è¦``mytest.cc`` è¿™ä¸ªæ–‡ä»¶æ¥å®ç°ä¸€ä¸ªæ‰“å°ç¯å¢ƒå˜é‡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹ï¼š

```c++
#include<iostream>

int main(int argc, char* argv[], char* env[])
{
    for (int i = 0; env[i]; i++)
    {
        std::cout << i << ":" << env[i] << std::endl;
    }
    return 0;
}
```

**å¯¹ä¸Šé¢ä»£ç çš„è§£é‡Š**

```c++
int argc, char* argv[], char* env[] 
// `int argc`ï¼š       å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ã€‚
// `char* argv[]`ï¼š   ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼ŒåŒ…å«äº†å‘½ä»¤è¡Œå‚æ•°ã€‚
// `char* env[]`ï¼š    ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼ŒåŒ…å«äº†ç¯å¢ƒå˜é‡ã€‚
```

```c++
for (int i = 0; env[i]; i++)
//è¿™æ˜¯ä¸€ä¸ª`for`å¾ªç¯ï¼Œç”¨äºéå†ç¯å¢ƒå˜é‡æ•°ç»„ã€‚å¾ªç¯çš„æ¡ä»¶æ˜¯`env[i]`ä¸ä¸º`NULL`ï¼Œè¿™æ„å‘³ç€å½“å‰ç´¢å¼•`i`å¤„æœ‰ç¯å¢ƒå˜é‡ã€‚å› ä¸ºç¯å¢ƒå˜é‡ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œç¯å¢ƒå˜é‡æ‰€å¯¹åº”çš„è¿™å¼ è¡¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œè¿™ä¸ªæŒ‡é’ˆæ•°ç»„æœ€ç»ˆä»¥ NULLç»“å°¾ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨éå†çš„æ—¶å€™ï¼Œé€€å‡ºå¾ªç¯çš„æ¡ä»¶å°±æ˜¯å½“ env[i]èµ°åˆ° NULL çš„æ—¶å€™ã€‚
```


å¥½äº†ï¼Œä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨``./myprocess`` ,è¿è¡Œä¸Šé¢çš„ä»£ç ï¼ˆè¿è¡Œä¹‹å‰è®°å¾—é‡æ–° makeä¸€ä¸‹)ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥çš„ç¯å¢ƒå˜é‡äº†ã€‚
é€šè¿‡è§‚å¯Ÿæ‰“å°å‡ºæ¥çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºè¿™æ ·çš„ä¸€ä¸ªç»“è®ºï¼š

==å½“æˆ‘ä»¬è¿›è¡Œç¨‹åºæ›¿æ¢çš„æ—¶å€™ï¼Œå­è¿›ç¨‹å¯¹åº”çš„ç¯å¢ƒå˜é‡æ˜¯ä»çˆ¶è¿›ç¨‹é‚£é‡Œå¾—æ¥çš„ï¼Œè€Œçˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡æ˜¯ä»å½“å‰å¯¹åº”çš„ shell å¾—æ¥çš„ã€‚==

æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼š

ä½¿ç”¨``export MYVAL=6666666666666666666666666666666666666666666`` å‘½ä»¤æ¥è‡ªå®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡åˆ°å½“å‰ bash è¿™ä¸ª shell ä¸­ï¼Œåå­—å«ï¼šMYVALã€‚å¯¹åº”çš„å†…å®¹æ˜¯ï¼š6666666666666666666666666666666666666666666

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ echo å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ï¼š``echo $MYVAL``;

ç„¶åé‡æ–°å†è¿è¡Œä¸€ä¸‹``./myprocess`` ï¼Œå°±å¯ä»¥çœ‹åˆ°ç¨‹åºæ‰“å°çš„ç¯å¢ƒå˜é‡ä¸­ æœ‰æˆ‘ä»¬è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡äº†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/8be370fbfdb343868691f2378f33a1b3.png)


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/10cab4ee6bc04b0fb373554d0d5b87ee.png)

æˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œä¸€æ¬¡å°è¯•ï¼Œä¸Šé¢æˆ‘ä»¬å¯¼å…¥çš„ç¯å¢ƒå˜é‡æ˜¯ç›´æ¥å¯¼å…¥åˆ° bash ä¸­çš„ï¼Œè¿™æ¬¡æˆ‘ä»¬åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œå¯¼å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œçœ‹çœ‹å­è¿›ç¨‹è¿˜æ‹¿ä¸æ‹¿å¾—åˆ°ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚
##### â“ æˆ‘ä»¬å¦‚ä½•è®©æˆ‘ä»¬çš„çˆ¶è¿›ç¨‹è‡ªå·±å¯¼å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡å‘¢ï¼Ÿ

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¼•å…¥ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š``putenv``  å¤´æ–‡ä»¶æ˜¯: ``stdlib.h`` ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å¯¼å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡

```c
# include <stdlib.h>
int putenv(char* string);
```

å¥½ï¼ŒçŸ¥é“äº†ä¸Šé¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„``myprocess.c`` ä»£ç ä¿®æ”¹æˆå¦‚ä¸‹:
```c
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <stdlib.h>
int main()
{
    char *env_val = "MYVAL2=88888888888888888888888888888";
    putenv(env_val);

    pid_t id = fork(); // åˆ›å»ºå­è¿›ç¨‹
    if (id == 0)       // è¿™é‡Œæ˜¯å­è¿›ç¨‹
    {
        printf("pid: %d, exec command begin\n", getpid());
        execl("./mytest", "mytest", NULL);
        printf("pid: %d, exec command end\n", getpid());
        exit(1);
    }
    else
    {
        // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
        pid_t rid = waitpid(-1, NULL, 0);
        if (rid > 0)
        {
            printf("wait sucess, rid: %d\n", rid);
        }
    }
    return 0;
}
```

make ä¹‹åï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥å‘ç°å­è¿›ç¨‹ä¸­æœ‰çˆ¶è¿›ç¨‹è‡ªå·±å¯¼å…¥çš„ç¯å¢ƒå˜é‡ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/4e2245d0d1194ef79898303ccd5a1cb5.png)


åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¹‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸»åŠ¨åœ°ä¼ é€’è¿‡ä»»ä½•ç¯å¢ƒå˜é‡ç»™å­è¿›ç¨‹ï¼Œä½†æ˜¯å­è¿›ç¨‹ä¸­ä¼šå‡ºç°çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œè¿™è¯´æ˜==ç¯å¢ƒå˜é‡è¢«å­è¿›ç¨‹ç»§æ‰¿ä¸‹å»æ˜¯ä¸€ç§é»˜è®¤è¡Œä¸ºï¼Œä¸å—ç¨‹åºæ›¿æ¢çš„å½±å“==ï¼Œ### ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

é€šè¿‡åœ°å€ç©ºé—´å¯ä»¥è®©å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡æ•°æ®ã€‚
ä½†æ˜¯ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°ä¹Ÿæ˜¯æ•°æ®å‘€ï¼Œæˆ‘ä»¬ä¹‹å‰è®²ç¨‹åºæ›¿æ¢çš„æ—¶å€™ä¸æ˜¯è¯´è¦æŠŠç›¸åº”è¿›ç¨‹çš„æ•°æ®æ®µå’Œä»£ç æ®µéƒ½æ›¿æ¢æ‰å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆè¿™é‡Œè¯´**ç¯å¢ƒå˜é‡è¢«å­è¿›ç¨‹ç»§æ‰¿ä¸‹å»ä¸å—åˆ°ç¨‹åºæ›¿æ¢çš„å½±å“** ï¼Ÿ

ç­”æ¡ˆå¾ˆç®€å•ï¼š ç¨‹åºæ›¿æ¢ç¡®å®æ˜¯æ›¿æ¢æ‰ä¹‹å‰ç¨‹åºçš„ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œä½†æ˜¯ç¯å¢ƒå˜é‡ä¸ä¼šè¢«æ›¿æ¢æ‰ã€‚


 > ç¯å¢ƒå˜é‡å…·æœ‰å…¨å±€å±æ€§


### âœï¸å­è¿›ç¨‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè·å¾—ç¯å¢ƒå˜é‡çš„æ–¹æ³•

#### ğŸ§²``execle``å‡½æ•°çš„ç›¸å…³çŸ¥è¯†ï¼š


`execle`å‡½æ•°æ˜¯Linuxç³»ç»Ÿç¼–ç¨‹ä¸­execå‡½æ•°æ—çš„ä¸€å‘˜ï¼Œå®ƒç”¨äºåœ¨å½“å‰è¿›ç¨‹ä¸­æ‰§è¡Œä¸€ä¸ªæ–°çš„ç¨‹åºï¼Œæ›¿æ¢å½“å‰è¿›ç¨‹çš„æ˜ åƒã€‚è¿™ä¸ªå‡½æ•°ç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡åˆ—è¡¨æ¥ä»£æ›¿å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚

 **å‡½æ•°åŸå‹ï¼š**
```c
int execle(const char *path, const char *arg, ..., char *const envp[]);
```

**å‚æ•°:**
- `path`ï¼šè¦æ‰§è¡Œçš„æ–‡ä»¶çš„è·¯å¾„ã€‚
- `arg`ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–°ç¨‹åºçš„åç§°ï¼Œåé¢è·Ÿç€ä¼ é€’ç»™æ–°ç¨‹åºçš„å‚æ•°ï¼Œå‚æ•°åˆ—è¡¨å¿…é¡»ä»¥`NULL`ç»“æŸã€‚
- `envp`ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ç¯å¢ƒå˜é‡æ•°ç»„çš„æŒ‡é’ˆæ•°ç»„ï¼Œæ–°ç¨‹åºçš„ç¯å¢ƒå˜é‡è®¾ç½®å°†ç”±è¿™ä¸ªæ•°ç»„å†³å®šã€‚

**è¿”å›å€¼:**
- å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œ`execle`ä¸ä¼šè¿”å›ã€‚
- å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œè¿”å›-1ï¼Œå¹¶è®¾ç½®`errno`ä»¥æŒ‡ç¤ºé”™è¯¯ã€‚

**æ³¨æ„äº‹é¡¹:**
- å‚æ•°åˆ—è¡¨å¿…é¡»ä»¥`NULL`ç»“æŸï¼Œè¿™è¡¨ç¤ºå‚æ•°åˆ—è¡¨çš„ç»“æŸã€‚
- `envp`å‚æ•°å…è®¸ä½ ä¸ºæ–°ç¨‹åºå®šä¹‰ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒå˜é‡é›†åˆï¼Œè¿™åœ¨æ‰§è¡Œéœ€è¦ç‰¹å®šç¯å¢ƒé…ç½®çš„ç¨‹åºæ—¶éå¸¸æœ‰ç”¨ã€‚
- ä½¿ç”¨`execle`æ—¶ï¼Œéœ€è¦æ³¨æ„æ–‡ä»¶è·¯å¾„ã€æƒé™ç­‰é—®é¢˜ï¼Œç¡®ä¿å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰é€‚å½“çš„æ‰§è¡Œæƒé™ã€‚

#### ğŸ§² æ–¹æ³•ä¸€ï¼šå°†çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™å­è¿›ç¨‹

##### 1.ç›´æ¥ç”¨
##### 2.ç›´æ¥ä¼ 
	çœ‹ä¾‹å­ğŸŒ°ï¼Œ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼š
	``myprocess.c``è¦æ”¹æˆè¿™æ ·ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯``execle``å‡½æ•°
```c
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <stdlib.h>

extern char **environ; // åœ¨è¿™é‡Œå£°æ˜ä¸€ä¸‹ã€‚

int main()
{

    pid_t id = fork(); // åˆ›å»ºå­è¿›ç¨‹
    if (id == 0)       // è¿™é‡Œæ˜¯å­è¿›ç¨‹
    {
        printf("pid: %d, exec command begin\n", getpid());
        execle("./mytest", "mytest", "-a", "-b", NULL, environ); // è¿™é‡Œè¦æŠ¥é”™ï¼Œè¯´ environ æœªå®šä¹‰ï¼Œä½†æ˜¯ environ æ˜¯è¢«åŒ…åœ¨äº†å¤´æ–‡ä»¶ unistd.h ä¸­ï¼Œæ²¡åŠæ³•ï¼Œæˆ‘ä»¬å¯ä»¥å»ä¸Šé¢å£°æ˜ä¸€ä¸‹
        printf("pid: %d, exec command end\n", getpid());
        exit(1);
    }
    else
    {
        // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
        pid_t rid = waitpid(-1, NULL, 0);
        if (rid > 0)
        {
            printf("wait sucess, rid: %d\n", rid);
        }
    }
    return 0;
}
```

``mytest.cc`` ,è¦ä¿®æ”¹ä¸ºä¸‹é¢è¿™æ ·ï¼š
```c++
#include <iostream>

int main(int argc, char *argv[], char *env[])
{
    for (int i = 0; i < argc; i++)
    {
        std::cout << i << " -> "  << argv[i] << std::endl; // æ‰“å°å‚æ•°
    }
    std::cout << "#####################################" << std::endl; // åˆ†å‰²çº¿è€Œå·²
    for (int i = 0; env[i]; i++)
    {
        std::cout << i << ":" << env[i] << std::endl;   // æ‰“å°ç¯å¢ƒå˜é‡
    }
    return 0;
}
```

#### ğŸ§² æ–¹æ³•äºŒï¼šä¼ æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç¯å¢ƒå˜é‡---æˆ‘ä»¬å¯ä»¥ç›´æ¥æ„é€ ç¯å¢ƒå˜é‡è¡¨ç»™å­è¿›ç¨‹ä¼ é€’

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼Œè‡ªå®šä¹‰ç¯å¢ƒå˜é‡ã€‚myprocess.c
```c
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <stdlib.h>

extern char **environ; // åœ¨è¿™é‡Œå£°æ˜ä¸€ä¸‹ã€‚

int main()
{

    // è‡ªå·±å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡
    char *const myenv[] = {
        "MYVAL1=11111111111111111111111111",
        "MYVAL2=11111111111111111111111111",
        "MYVAL3=11111111111111111111111111",
        "MYVAL4=11111111111111111111111111", NULL // æ³¨æ„ä¸è¦å¿˜äº†ï¼Œä»¥ NULL ç»“å°¾ã€‚
    };
    pid_t id = fork(); // åˆ›å»ºå­è¿›ç¨‹
    if (id == 0)       // è¿™é‡Œæ˜¯å­è¿›ç¨‹
    {
        printf("pid: %d, exec command begin\n", getpid());
        execle("./mytest", "mytest", "-a", "-b", NULL, myenv);
        printf("pid: %d, exec command end\n", getpid());
        exit(1);
    }
    else
    {
        // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
        pid_t rid = waitpid(-1, NULL, 0);
        if (rid > 0)
        {
            printf("wait sucess, rid: %d\n", rid);
        }
    }
    return 0;
}
```

ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹æ¥è¯•è¯•ã€‚ï¼ˆæ²¡è¯´æ˜çš„è¯ mytest.cc å°±ä¸åšæ”¹å˜ï¼‰

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d7b06d206bb045ba9b276ed1be42e6ec.png)


é€šè¿‡è§‚å¯Ÿè¿è¡Œç»“æœæˆ‘ä»¬çŸ¥é“ï¼Œå­è¿›ç¨‹æ‹¿åˆ°çš„åªæœ‰æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç¯å¢ƒå˜é‡è¡¨äº†ã€‚

> æ³¨æ„ï¼šé€šè¿‡ä¸Šé¢çš„è¿è¡Œç»“æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œexecle å‡½æ•°æ¥ä¼ é€’ç¯å¢ƒå˜é‡æ—¶ï¼Œä¸æ˜¯æ–°å¢ç¯å¢ƒå˜é‡ï¼Œè€Œæ˜¯è¦†ç›–æ‰ä¹‹å‰çš„ç¯å¢ƒå˜é‡ï¼ŒåŒç†å¯ä»¥æ¨å¯¼å‡ºå…¶ä»– exec æ—å‡½æ•°ä¸­ä¹Ÿä¸€æ ·ï¼Œå¸¦``e``çš„ï¼Œä¸æ˜¯æ–°å¢ï¼Œè€Œæ˜¯è¦†ç›–



---

# ğŸ·ï¸ ææ–™å‡†å¤‡

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶:``myshell.c``:
```c
#include <stdio.h>

int main()
{

    return 0;
}
```

åˆ›å»ºä¸€ä¸ª ``Makefile`` æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```Makefile
Â  1 mybash:myshell.c

Â  2 Â  g++ -o $@ $^ -std=c++11Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 

Â  3 .PHONY:cleanÂ  Â  Â  Â  Â  Â  Â 

Â  4 clean:Â  Â  Â  Â  Â  Â 

Â  5 Â  rm -f mybash
```


# ğŸ·ï¸ æ‰“å°æç¤ºç¬¦ï¼Œè·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²

## ğŸ“Œ ï¼ˆæ‰“å°æç¤ºç¬¦ï¼‰å¡«å†™ï¼šç”¨æˆ·åï¼Œä¸»æœºåï¼Œå½“å‰æ‰€åœ¨çš„å·¥ä½œç›®å½•

æˆ‘ä»¬æ‰“å¼€ç»ˆç«¯ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/37fb94effab0420d9cde1e7ae0dfad1d.png)


æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ shell æ–‡ä»¶ç³»ç»Ÿä¹Ÿè¦è·å–è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€äº›å‡½æ•°ï¼š

```c
// è·å–å½“å‰çš„ç”¨æˆ·å
const char* getUsername()
{}

// è·å–å½“å‰çš„ä¸»æœºå
const char* getHostname()
{}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char* getCwd()
{}
```


ä½¿ç”¨``getenv()`` è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–å½“å‰çš„ç¯å¢ƒå˜é‡ï¼Œå¤´æ–‡ä»¶æ˜¯``stdlib.h`` ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ¥å†™ï¼š

```c
#include <stdio.h>
#include <stdlib.h>

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name; // è·å–æˆåŠŸå°±è¿”å›åå­—
    else
        return "none"; // è·å–å¤±è´¥å°±è¿”å› none
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int main()
{
    printf("[%s@%s %s]ï¿¥\n", getUsername(), getHostname(), getCwd()); // è¿™é‡Œçš„ printf è¾“å‡ºæ˜¯ä»¿é€ ç»ˆç«¯é‚£ç§æ ¼å¼çš„ï¼Œæˆ‘æŠŠ $ æ¢æˆäº†äººæ°‘å¸çš„ ï¿¥ï¼Œä½ å¯ä»¥è‡ªå·±æ¢æˆå…¶ä»–çš„
    return 0;
}
```

``make`` ä¹‹å ï¼Œè¿è¡Œä¸€ä¸‹ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/7f35774f2eda41e283c5813586ba1f5c.png)
ä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿è¡Œä¹‹åç¨‹åºå°±ç»“æŸäº†ï¼ŒæŒ‰ç†è¯´æ­£å¸¸çš„ shell æ˜¯å¯ä»¥è¾“å…¥å‘½ä»¤çš„ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼š

æˆ‘ä»¬åŠ å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
```c
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
 char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
scanf("%s", usercommand); // ç”¨æˆ·è¾“å…¥å‘½ä»¤
```

åˆåœ¨ä¸€èµ·æ˜¯è¿™æ ·çš„ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚


// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd()); 

    scanf("%s", usercommand); // ç”¨æˆ·è¾“å…¥å‘½ä»¤
    return 0;
}
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/27bf660d997246e9bfc69491ae5fa507.png)
## ğŸ“Œ ï¼ˆè·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²ï¼‰å‘æˆ‘ä»¬è‡ªå®šä¹‰çš„ bash ä¸­è¾“å…¥å‘½ä»¤

æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`` echo`` æ¥æ‰“å°ä¸€ä¸‹æˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤æ˜¯æ€ä¹ˆæ ·çš„ 
```c
printf("echo:\n%s", usercommand);  // æˆ‘ä»¬ç”¨è¿™æ¡è¯­å¥æ¥æ˜¾ç¤ºä¸€ä¸‹è¾“å…¥çš„å‘½ä»¤åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­åŠ ä¸Šè¿™ä¸€è¡Œï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚


// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());

    scanf("%s", usercommand); // ç”¨æˆ·è¾“å…¥å‘½ä»¤
    /******************************************************************************/
    printf("echo:\n%s", usercommand);  // æˆ‘ä»¬ç”¨è¿™æ¡è¯­å¥æ¥æ˜¾ç¤ºä¸€ä¸‹è¾“å…¥çš„å‘½ä»¤åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„
    /******************************************************************************/
    return 0;
}
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/798fa2d6df2649d6b3fee2f0a3c1a070.png)


å› ä¸ºï¼Œæˆ‘ä»¬æ˜¯ç”¨çš„``scanf`` ,å®ƒé‡åˆ°ç©ºæ ¼å°±ä¼šåœä¸‹æ¥ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ¢ä¸€ä¸ª,ä½¿ç”¨ ``fgets()`` å‡½æ•°ï¼Œå¤´æ–‡ä»¶æ˜¯ï¼š``stdio.h``;

```c
#include <stdio.h>
char *fgets(char *str, int num, FILE *stream);
```

**å‚æ•°:**
- `str`ï¼šæŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨ä»æ–‡ä»¶æµä¸­è¯»å–çš„å­—ç¬¦ä¸²ã€‚
- `num`ï¼šæŒ‡å®šæœ€å¤šè¯»å–çš„å­—ç¬¦æ•°ï¼ŒåŒ…æ‹¬æœ€åçš„ç©ºå­—ç¬¦ï¼ˆ`\0`ï¼‰ã€‚
- `stream`ï¼šæŒ‡å‘Â `FILE`Â ç»“æ„çš„æŒ‡é’ˆï¼ŒæŒ‡å®šäº†è¦è¯»å–çš„æ–‡ä»¶æµã€‚

**è¿”å›å€¼:**
- å¦‚æœæˆåŠŸè¯»å–ï¼Œ`fgets`Â è¿”å›ä¸€ä¸ªæŒ‡å‘Â `str`Â çš„æŒ‡é’ˆã€‚(è·å–æˆåŠŸå°±æ˜¯ä½ è¾“å…¥çš„å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€)
- å¦‚æœé‡åˆ°é”™è¯¯æˆ–æ–‡ä»¶ç»“æŸç¬¦ï¼ˆEOFï¼‰ï¼Œè¿”å›Â `NULL`ã€‚ï¼ˆè·å–å¤±è´¥å°±è¿”å› NULLï¼‰

 
 ğŸ§² çŸ¥è¯†è¡¥å……ï¼š
C è¯­è¨€ä¼šé»˜è®¤æ‰“å¼€ä¸‰ä¸ªè¾“å…¥è¾“å‡ºæµï¼Œåˆ†åˆ«å«åšï¼š``stdin``, ``stdout``, ``stderr``; å®ƒä»¬çš„ç±»å‹éƒ½æ˜¯ ``FILE*``  
 ``stdin``    :  é”®ç›˜
 ``stdout``  :  æ˜¾ç¤ºå™¨
 ``stderr ``:  æ˜¾ç¤ºå™¨

 æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†``scanf()`` å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼Œä¿®æ”¹æˆè¿™æ ·ï¼š
 ```c
  fgets(usercommand, sizeof usercommand, stdin);
```

1. `sizeof usercommand`ï¼šç”¨äºè®¡ç®— `usercommand` æ•°ç»„çš„å¤§å°ï¼ˆå³æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ï¼Œé€šå¸¸ä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç”¨æ¥ç¡®å®š `fgets` å‡½æ•°å¯ä»¥è¯»å–çš„æœ€å¤§å­—ç¬¦æ•°ã€‚æ³¨æ„ï¼Œ`sizeof` åé¢ç´§è·Ÿå˜é‡åï¼Œä¸éœ€è¦æ‹¬å·ã€‚
2. `stdin`ï¼šæ˜¯ C è¯­è¨€æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä»£è¡¨æ ‡å‡†è¾“å…¥æµã€‚å®ƒé€šå¸¸ä¸é”®ç›˜è¾“å…¥å…³è”ã€‚`stdin` æ˜¯ `FILE` ç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ ‡å‡†è¾“å…¥è®¾å¤‡ã€‚

å…³äº `sizeof` æ“ä½œç¬¦çš„ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶è¿ç®—ç¬¦ï¼Œç”¨äºè·å–å˜é‡æˆ–ç±»å‹æ‰€å ç”¨çš„å­—èŠ‚æ•°ã€‚å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹¬å·ã€‚æ‹¬å·é€šå¸¸ç”¨äº `sizeof` æ“ä½œç¬¦çš„è¯­æ³•æ˜¯å½“å®ƒç”¨äºæ•°æ®ç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯å˜é‡çš„æ—¶å€™ï¼Œä¾‹å¦‚ `sizeof(int)`ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(usercommand, sizeof usercommand, stdin);
    if (r == NULL)
        return 1;                     // è·å–å¤±è´¥
    printf("%s\n", usercommand); // æˆ‘ä»¬ç”¨è¿™æ¡è¯­å¥æ¥æ˜¾ç¤ºä¸€ä¸‹è¾“å…¥çš„å‘½ä»¤åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„
    return 0;
}
```

è¿è¡Œä¹‹åè¿™é‡Œæœ‰ä¸€ä¸ªå°çš„ç»†èŠ‚ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d9e0cb7beb0c4311a4b597aeea09135a.png)

ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å†ä»£ç ä¸­åŠ å…¥ä¸‹é¢è¿™æ ·ä¸€è¡ŒğŸ‘‡ğŸ»ï¼š

```c
#include <string.h>

usercommand[strlen(usercommand) - 1] = '\0'; // å°†å€’æ•°ç¬¬äºŒä¸ªå­—ç¬¦å˜æˆâ€˜\0â€™,è¿™æ ·å°±ä¸ä¼šè¯»å–åˆ°æˆ‘ä»¬æœ€åçš„é‚£ä¸ªå›è½¦æ¢è¡Œäº†
```

æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>  

#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(usercommand, sizeof usercommand, stdin);
    if (r == NULL)
        return 1;   // è·å–å¤±è´¥

    usercommand[strlen(usercommand) - 1] = '\0';
    printf("%s\n", usercommand); // æˆ‘ä»¬ç”¨è¿™æ¡è¯­å¥æ¥æ˜¾ç¤ºä¸€ä¸‹è¾“å…¥çš„å‘½ä»¤åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„
    return 0;
}

```

é—®ä¸€ä¸‹ï¼šæˆ‘ä»¬è¿™æ ·å†™ä¼šä¸ä¼šè¶Šç•Œå‘¢ï¼Ÿ
```c
usercommand[strlen(usercommand) - 1] = '\0';
```
ä¸‡ä¸€``usercommand`` ç”¨ strlen æ±‚é•¿åº¦ä¹‹åæ˜¯ 0 ï¼Œ é‚£å†å‡ 1 ä¸å°±è¶Šç•Œäº†å—ï¼Ÿ
ç­”æ¡ˆæ˜¯ï¼šä¸ä¼šè¶Šç•Œã€‚
å› ä¸ºï¼šä½ çš„``usercommand`` çš„é•¿åº¦ä¸å¯èƒ½æ˜¯ 0 ï¼Œå› ä¸ºä½ å°±ç®—ä»€ä¹ˆä¹Ÿä¸è¾“å…¥ï¼Œæœ€åä¹Ÿè¦è¾“å…¥ä¸ª ``å›è½¦`` æ¥è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥``usercommand`` ä¸­è‚¯å®šæœ‰ä¸€ä¸ª``å›è½¦``çš„ã€‚é•¿åº¦å°±ä¸å¯èƒ½æ˜¯ 0 ã€‚

æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç å°è£…ä¸€ä¸‹ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int getUserCommand(char *command, int num) // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
    printf("%s", usercommand);                            
    return 0;
}
```



# ğŸ·ï¸ åˆ†å‰²ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²

â“ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ
å‡è®¾ç”¨æˆ·è¾“å…¥çš„æ˜¯ï¼š``ls -a -l`` ï¼Œæˆ‘ä»¬è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²æ‹†è§£ä¸º:``â€œlsâ€``, ``"-a"`` , ``"-l"``ã€‚

### **åˆ›å»ºæ•°ç»„:**
æˆ‘ä»¬è¦æŠŠæ‹†åˆ†ä¹‹åçš„è¿™äº›å­—ç¬¦ä¸²å­˜èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼š
```c
#define SIZE 64
char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL
```
å¹¶ä¸”æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæ•°ç»„ä»¥ NULL ç»“å°¾ã€‚
### **å¦‚ä½•åˆ†å‰²è¿™ä¸ªå­—ç¬¦ä¸²å‘¢ï¼Ÿï¼š**

##### å‡½æ•°ï¼š``strtok``

ä½¿ç”¨å‡½æ•°ï¼š``strtok()``ã€‚å¤´æ–‡ä»¶ï¼š``string.h``

```c
char *strtok(char *str, const char *delim);
```

 **å‚æ•°**

- `str`ï¼šæŒ‡å‘è¦åˆ†å‰²çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨Â `strtok`Â æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¿…é¡»æä¾›è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼›åœ¨éšåçš„è°ƒç”¨ä¸­ï¼Œåº”è¯¥ä¼ é€’Â `NULL`ã€‚
- `delim`ï¼šæŒ‡å‘åˆ†éš”ç¬¦é›†çš„æŒ‡é’ˆï¼ŒæŒ‡å®šäº†ç”¨äºåˆ†å‰²å­—ç¬¦ä¸²çš„ä¸€ç»„å­—ç¬¦ã€‚

**è¿”å›å€¼**

- `strtok`Â è¿”å›ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªæ ‡è®°çš„æŒ‡é’ˆã€‚å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ ‡è®°æˆ–é‡åˆ°å­—ç¬¦ä¸²ç»“æŸï¼Œè¿”å›Â `NULL`ã€‚

##### ä¸ºäº†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªåˆ†éš”ç¬¦æ¥ä¼ ç»™å®ƒ

```c
#define SEP " " // æ³¨æ„æˆ‘ä»¬è¿™é‡Œå¼•å·é‡Œçš„æ˜¯ç©ºæ ¼
```

##### ä½¿ç”¨å‡½æ•°

```c
    argv[argc++] = strtok(usercommand, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (argv[argc++] = strtop(NULL, SEP)); // ç¬¬äºŒæ¬¡ä¼ å‚å’Œä¹‹åçš„ä¼ å‚å°±åªèƒ½ä¼ ï¼šNULL
```

è®©æˆ‘ä»¬é€æ­¥åˆ†æè¿™æ®µä»£ç ï¼š

1. `argv[argc++] = strtok(usercommand, SEP);`
    
    - `strtok(usercommand, SEP)`ï¼šè°ƒç”¨Â `strtok`Â å‡½æ•°ï¼Œå°†Â `usercommand`Â å­—ç¬¦ä¸²æŒ‰ç…§Â `SEP`Â ä¸­å®šä¹‰çš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªæ ‡è®°ã€‚
    - `argv[argc++]`ï¼šå°†åˆ†å‰²å¾—åˆ°çš„ç¬¬ä¸€ä¸ªæ ‡è®°èµ‹å€¼ç»™Â `argv`Â æ•°ç»„çš„å½“å‰ä½ç½®ï¼Œå¹¶ä¸”å°†Â `argc`åŠ  1ã€‚
2. `while (argv[argc++] = strtok(NULL, SEP));`
    - è¿™ä¸ªå¾ªç¯ç»§ç»­è°ƒç”¨Â `strtok`Â å‡½æ•°ï¼Œä½†æ˜¯è¿™æ¬¡ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Â `NULL`ã€‚åœ¨Â `strtok`Â ä¸­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Â `NULL`ï¼Œå®ƒä¼šæ¥ç€å¤„ç†ä¸Šæ¬¡è°ƒç”¨æ—¶ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯Â `usercommand`ï¼‰ã€‚
    - `strtok(NULL, SEP)`ï¼šè¿”å›ä¸‹ä¸€ä¸ªæ ‡è®°ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„æ ‡è®°å¯ä»¥è¿”å›ï¼Œè¿™æ—¶Â `strtok`Â ä¼šè¿”å›Â `NULL`ã€‚(æ‰€ä»¥å½“ strtok è¿”å› NULL çš„æ—¶å€™å°±æ„å‘³ç€å­—ç¬¦ä¸²å·²ç»è¢«åˆ†å‰²å®Œäº†ï¼Œå¹¶ä¸”è¿™ä¸ª NULL ä¹Ÿä¼šè¢«èµ‹å€¼ç»™ argvæ•°ç»„ï¼ˆæ»¡è¶³äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼šargv è¿™ä¸ªæ•°ç»„æœ€åä»¥ NULL ç»“å°¾ï¼‰)
    - `argv[argc++]`ï¼šå°†æ¯ä¸ªæ–°çš„æ ‡è®°å­˜å‚¨åœ¨Â `argv`Â æ•°ç»„çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œå¹¶å°†Â `argc`Â åŠ  1ã€‚
    - å¾ªç¯ç»§ç»­ç›´åˆ°Â `strtok`Â è¿”å›Â `NULL`ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„æ ‡è®°éƒ½å·²ç»è¢«æå–ã€‚


åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`while` å¾ªç¯çš„ç»“æŸæ¡ä»¶æ˜¯ `strtok` å‡½æ•°è¿”å› `NULL`ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ç”± `strtok` å‡½æ•°çš„ç‰¹æ€§å†³å®šçš„ã€‚
`strtok` å‡½æ•°åœ¨æ¯æ¬¡è°ƒç”¨æ—¶ä¼šè¿”å›ä¸‹ä¸€ä¸ªæ ‡è®°ï¼ˆtokenï¼‰ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„æ ‡è®°å¯ä»¥è¿”å›ã€‚å½“ `strtok` é‡åˆ°å­—ç¬¦ä¸²çš„ç»“å°¾æˆ–è€…åªåŒ…å«åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šè¿”å› `NULL`ã€‚åœ¨ `while` å¾ªç¯çš„æ¡ä»¶ä¸­ï¼Œ`strtok` çš„è¿”å›å€¼è¢«èµ‹å€¼ç»™ `argv[argc++]`ï¼Œç„¶åæ¡ä»¶æ£€æŸ¥è¿™ä¸ªèµ‹å€¼çš„ç»“æœæ˜¯å¦ä¸º `NULL`ã€‚
è¿™é‡Œæ˜¯è¯¦ç»†çš„è¿‡ç¨‹ï¼š
1. é¦–æ¬¡è°ƒç”¨ `strtok(usercommand, SEP)` è¿”å›ç¬¬ä¸€ä¸ªæ ‡è®°ï¼Œå¹¶å°†è¿™ä¸ªæ ‡è®°èµ‹å€¼ç»™ `argv[argc]`ï¼Œç„¶å `argc` è‡ªå¢ã€‚
    
2. åœ¨éšåçš„ `while` å¾ªç¯ä¸­ï¼Œ`strtok(NULL, SEP)` è¢«è°ƒç”¨ï¼Œå®ƒç»§ç»­å¤„ç†ä¸Šæ¬¡è°ƒç”¨ `strtok` æ—¶ç•™ä¸‹çš„å­—ç¬¦ä¸²ã€‚æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸‹ä¸€ä¸ªæ ‡è®°ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„æ ‡è®°ã€‚
    
3. æ¯æ¬¡ `strtok` è¿”å›ä¸€ä¸ªé `NULL` å€¼æ—¶ï¼Œè¿™ä¸ªå€¼éƒ½ä¼šè¢«èµ‹å€¼ç»™ `argv[argc]`ï¼Œç„¶å `argc` è‡ªå¢ï¼Œå¾ªç¯ç»§ç»­ã€‚
    
4. å½“ `strtok` è¿”å› `NULL` æ—¶ï¼Œ`while` å¾ªç¯çš„æ¡ä»¶ä¸å†æ»¡è¶³ï¼ˆå› ä¸º `NULL` ç­‰ä»·äºé€»è¾‘å‡ï¼‰ï¼Œå¾ªç¯ç»“æŸã€‚
    
`while` å¾ªç¯ç»“æŸçš„åŸå› æ˜¯å› ä¸º `strtok` å·²ç»è¯»å–äº†æ‰€æœ‰çš„è¾“å…¥å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ²¡æœ‰æ›´å¤šçš„æ ‡è®°å¯ä»¥è¿”å›ã€‚è¿™é€šå¸¸æ„å‘³ç€å·²ç»åˆ°è¾¾äº†å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œæˆ–è€…å­—ç¬¦ä¸²ä¸­åªå‰©ä¸‹äº†åˆ†éš”ç¬¦ã€‚



### æˆ‘ä»¬è¦ç”¨ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­ä¸²çš„ä¸ªæ•°
è¿™ä¸ªå˜é‡å°±æ˜¯ï¼šargc
```c
int argc = 0;
```


#### æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

int getUserCommand(char *command, int num) // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL
    int argc = 0;              // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°

    /********************************************************************************* */
    /******                  1.  æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²                  ********* */
    /******************************************************************************* */

    getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    /********************************************************************************* */
    /******                  2.       åˆ†å‰²å‘½ä»¤                                   ****** */
    /******************************************************************************** */
    argv[argc++] = strtok(usercommand, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (argv[argc++] = strtop(NULL, SEP))
        ;

    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; argv[i]; i++)
    {
        printf("%d:%s\n", i, argv[i]);
    }

    /******************************************************************************** */
    /******                        3.   æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤                        ********* */
    /******************************************************************************* */
    printf("%s", usercommand); // æˆ‘ä»¬ç”¨è¿™æ¡è¯­å¥æ¥æ˜¾ç¤ºä¸€ä¸‹è¾“å…¥çš„å‘½ä»¤åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„
    return 0;
}
```

æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼š 
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/196eb98b0bc14af4aae4aae51144ca53.png)

##### æˆ‘ä»¬æŠŠè¿™ä¸ªåˆ‡å‰²å­—ç¬¦ä¸²çš„åŠŸèƒ½å°è£…ä¸€ä¸‹ï¼š

```c
// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char* in, char* out[])
{
    int argc = 0;              // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;

    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
}
```

æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œå› ä¸º for å¾ªç¯åªæ˜¯æˆ‘ä»¬ç”¨æ¥éªŒè¯åˆ†å‰²å¯¹æ²¡æœ‰çš„ï¼Œæˆ‘ä»¬åªæœ‰åœ¨è°ƒè¯•çš„æ—¶å€™æ‰ä¼šç”¨åˆ° forå¾ªç¯é‡Œé¢çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŠ ä¸Šæ¡ä»¶ç¼–è¯‘

```c
// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}
```

`#ifdef` å’Œ `#endif` æ˜¯ C è¯­è¨€é¢„å¤„ç†å™¨æŒ‡ä»¤ï¼Œç”¨äºæ¡ä»¶ç¼–è¯‘ã€‚è¿™äº›æŒ‡ä»¤å…è®¸ä½ æ ¹æ®æ˜¯å¦å®šä¹‰äº†ç‰¹å®šçš„å®æ¥å†³å®šæ˜¯å¦ç¼–è¯‘ä»£ç çš„æŸä¸ªéƒ¨åˆ†ã€‚

** `#ifdef Debug`**

`#ifdef` æ˜¯ "if defined" çš„ç¼©å†™ã€‚`#ifdef Debug` æ£€æŸ¥æ˜¯å¦å®šä¹‰äº†åä¸º `Debug` çš„å®ã€‚å¦‚æœ `Debug` å·²ç»è¢«å®šä¹‰ï¼ˆé€šå¸¸æ˜¯åœ¨ç¼–è¯‘æ—¶é€šè¿‡ç¼–è¯‘å™¨é€‰é¡¹å®šä¹‰çš„ï¼‰ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šç¼–è¯‘ `#ifdef` å’Œ `#endif` ä¹‹é—´çš„ä»£ç ã€‚

** `#endif`**

`#endif` è¡¨ç¤ºæ¡ä»¶ç¼–è¯‘çš„ç»“æŸã€‚å®ƒæ ‡å¿—ç€ `#ifdef` æˆ–å…¶ä»–æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼ˆå¦‚ `#if`, `#ifndef`, `#elif`ï¼‰å¼€å§‹çš„æ¡ä»¶ç¼–è¯‘ä»£ç å—çš„ç»“æŸã€‚

åœ¨ä¸Šé¢æˆ‘ä»¬çš„ä»£ç ä¸­ï¼š
```c
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
```
å¦‚æœ `Debug` å®è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°†è¢«ç¼–è¯‘å’Œæ‰§è¡Œï¼Œç”¨äºæ‰“å°å‡ºåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„ `out` ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚è¿™é€šå¸¸ç”¨äºè°ƒè¯•ç›®çš„ï¼Œä»¥ç¡®ä¿å­—ç¬¦ä¸²è¢«æ­£ç¡®åˆ†å‰²ã€‚
å¦‚æœæ²¡æœ‰å®šä¹‰ `Debug` å®ï¼Œé‚£ä¹ˆ `#ifdef` å’Œ `#endif` ä¹‹é—´çš„ä»£ç å°†ä¸ä¼šè¢«ç¼–è¯‘ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆçš„æ‰§è¡Œç¨‹åºä¸­ã€‚è¿™æ ·åšå¯ä»¥é¿å…åœ¨å‘å¸ƒç‰ˆæœ¬çš„ç¨‹åºä¸­åŒ…å«è°ƒè¯•ä»£ç ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºçš„å¤§å°å’Œæé«˜æ€§èƒ½ã€‚

å¦‚æœæˆ‘ä»¬ä»¥åè¦è°ƒè¯•å®ƒçš„è¯ï¼Œåªéœ€è¦æŠŠ``Debug`` å®šä¹‰å‡ºæ¥å°±è¡Œäº†ï¼Œåƒè¿™æ ·ï¼š
```c
#define Debug 1
```
1. `#define`ï¼šæŒ‡ä»¤å‘Šè¯‰é¢„å¤„ç†å™¨å®šä¹‰ä¸€ä¸ªå®ã€‚
2. `Debug`ï¼šæ˜¯è¦å®šä¹‰çš„å®çš„åç§°ã€‚
3. `1`ï¼šæ˜¯å®çš„å€¼ã€‚åœ¨å®å®šä¹‰ä¸­ï¼Œé€šå¸¸ä½¿ç”¨Â `1`Â æˆ–è€…ä¸èµ‹å€¼ï¼ˆå³åªæœ‰Â `#define Debug`ï¼‰ï¼Œå› ä¸ºå®å®šä¹‰æœ¬èº«ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦çš„æ›¿æ¢ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚
å½“æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨ `#ifdef Debug` æ—¶ï¼Œé¢„å¤„ç†å™¨ä¼šæ£€æŸ¥æ˜¯å¦å®šä¹‰äº† `Debug` å®ã€‚ç”±äº `Debug` è¢«å®šä¹‰ä¸º `1`ï¼Œå®ƒè¢«è§†ä¸ºçœŸå€¼ï¼ˆåœ¨ C è¯­è¨€ä¸­ï¼Œé™¤äº† `0` ä»¥å¤–çš„æ‰€æœ‰å€¼éƒ½è¢«è§†ä¸ºçœŸå€¼ï¼‰ï¼Œå› æ­¤ `#ifdef Debug` å†…çš„ä»£ç å—å°†è¢«åŒ…å«åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­

##### å¦‚æœæˆ‘ä»¬è¦è°ƒè¯•çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ Debug æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
#define Debug 1
// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

    /********************************************************************************** */
    /******                  1.  æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²                   ********* */
    /******************************************************************************** */

    getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    /******************************************************************************** */
    /******                  2.       åˆ†å‰²å‘½ä»¤                               ********* */
    /******************************************************************************* */

    commandSplit(usercommand, argv);
    /******************************************************************************** */
    /******                        3.   æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤                        ********* */
    /******************************************************************************** */

    return 0;
}
```




# ğŸ·ï¸ æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤

æˆ‘ä»¬åˆ›å»ºå­è¿›ç¨‹æ¥æ‰§è¡Œæˆ‘ä»¬å¯¹åº”çš„å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨``fork()`` å‡½æ•°ï¼Œå¤´æ–‡ä»¶ï¼š``unistd.h`` 

```c
// 3.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
    pid_t id = fork();
    if (id < 0)
        return 1;     // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› 1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp(),æŠŠç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ä¼ è¿›å»ã€‚

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }
```

æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// #define Debug 1
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

int main()
{
    char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

    //  1.æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²
    getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

    // 2.åˆ†å‰²å‘½ä»¤
    commandSplit(usercommand, argv);

    // 3.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
    pid_t id = fork();
    if (id < 0)
        return 1;     // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› 1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }
    return 0;
}
```

æˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/00b1cfc4649542ad91aea84e94c32d43.png)

å“ï¼ æˆåŠŸäº†ã€‚

ä½†æ˜¯ï¼æˆ‘ä»¬çš„ mybash åªèƒ½æ‰§è¡Œä¸€æ¬¡è€Œç³»ç»Ÿçš„bashæ˜¯æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤ä¹‹åè¿˜å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦ä¼˜åŒ–ä¸€ä¸‹ä¹‹å‰çš„ä»£ç ï¼Œè®©æˆ‘ä»¬çš„ mybash ä¹Ÿèƒ½å‘¨è€Œå¤å§‹çš„æ‰§è¡Œã€‚

è¿™ç®€å•å‘€ï¼šå¤–é¢å¥—ä¸€ä¸ªæ­»å¾ªç¯å°±è¡Œäº†ï¼š
```c
while (1)
{
	// æˆ‘ä»¬ä¹‹å‰çš„çš„ä»£ç é€»è¾‘
}
```

æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// #define Debug 1
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

int main()
{
    while (1)
    {
        char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

        //  1.æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²
        getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        // 2.åˆ†å‰²å‘½ä»¤
        commandSplit(usercommand, argv);

        // 3.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
        pid_t id = fork();
        if (id < 0)
            return 1;     // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› 1ï¼›
        else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
        {
            // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
            execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

            exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
        }
        else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
        {
            // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
            pid_t rid = waitpid(id, NULL, 0);
            if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
            {
            }
        }
    }
    return 0;
}
```

çœ‹ï¼Œæˆ‘ä»¬å°±èƒ½ä¸€ç›´è¾“å…¥å‘½ä»¤äº†ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/49f2d439d0404f86b7165d63e91992b4.png)

å¥½äº†ï¼Œæˆ‘ä»¬å†æŠŠæ‰§è¡Œå‘½ä»¤çš„ä»£ç å°è£…ä¸€ä¸‹ï¼š
```c
// æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int execute(char *argv[])
{
    pid_t id = fork();
    if (id < 0)
        return -1;    // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› -1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }

    return 0;
}
```

æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// #define Debug 1
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

// æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int execute(char *argv[])
{
    pid_t id = fork();
    if (id < 0)
        return -1;    // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› -1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }

    return 0;
}

int main()
{
    while (1)
    {
        char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

        //  1.æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²
        getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        // 2.åˆ†å‰²å‘½ä»¤
        commandSplit(usercommand, argv);

        // 3.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
        execute(argv);
    }
    return 0;
}
```


# ğŸ·ï¸ æœ‰ä¸€æ‰¹å‘½ä»¤è¦ç”±çˆ¶è¿›ç¨‹æ¥æ‰§è¡Œ----- å†…å»ºå‘½ä»¤

##### ä»€ä¹ˆæ˜¯å†…å»ºå‘½åï¼š

å†…å»ºå‘½ä»¤å°±æ˜¯``bash`` è‡ªå·±æ‰§è¡Œçš„ï¼Œç±»ä¼¼äºè‡ªå·±å†…éƒ¨çš„ä¸€ä¸ªå‡½æ•°ã€‚

 

ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å·²ç»å¯ä»¥å®ç°ä¸€ä¸ªshell çš„ä¸€äº›åŠŸèƒ½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°è¿™æ ·çš„ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼šä½ è¿è¡Œ``mybash`` ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ï¼š``pwd``, ``ls`` ä¹‹ç±»çš„å‘½ä»¤ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æƒ³åšè·¯åŠ²åˆ‡æ¢çš„æ—¶å€™ç¼ºå‘ç°ä¸è¡Œï¼Œæ¯”å¦‚ï¼š``cd ..`` ã€‚
å› ä¸ºæˆ‘ä»¬ä»£ç ä¸­çš„å‘½ä»¤éƒ½æ˜¯ ``fork()``äº†ä¸€ä¸ªå­è¿›ç¨‹å‡ºæ¥æ‰§è¡Œçš„ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åšè·¯å¾„åˆ‡æ¢ï¼Œåˆ‡æ¢çš„æ˜¯å½“å‰è¿™ä¸ª mybash çš„è·¯å¾„ï¼Œæ‰€ä»¥è¦ç”±çˆ¶è¿›ç¨‹æ¥æ‰§è¡Œã€‚

##### æ‰€ä»¥æˆ‘ä»¬è¦åŒºåˆ†ä¸€ä¸‹ï¼Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤ï¼ˆbuild-inï¼‰

```c
// 3. æ£€æŸ¥å¯¹åº”çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤, ç”¨ 1 è¡¨ç¤ºæ˜¯å†…å»ºå‘½ï¼Œç”¨ 0 è¡¨ç¤ºä¸æ˜¯å†…å»ºå‘½ä»¤
int doBuildin(char *argv[])
{
    if (strcmp(argv[0], "cd") == 0)
    {
        char *path = NULL;   // å¦‚æœæˆ‘ä»¬ä½¿ç”¨ cd å‘½ä»¤ï¼Œé‚£ä¹ˆåé¢æ˜¯æœ‰è·¯åŠ²çš„ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ pathæ¥è¡¨ç¤º
        if (argv[1] == NULL) // å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥è·¯åŠ²ï¼Œé‚£æˆ‘ä»¬é»˜è®¤æ˜¯å½“å‰è·¯åŠ²ï¼š"."
        {
            path = ".";
        }
        else
        {
            path = argv[1]; // else çš„è¯å°±è¯´æ˜ç”¨æˆ·è¾“å…¥äº†è·¯å¾„
        }

        cd(path);
        return 1; // æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬ return 1ï¼›
    }
    return 0; // ä¸æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬å°±return 0;
}
```

##### å¦‚æœæ˜¯å†…å»ºå‘½ä»¤``cd`` ï¼Œæˆ‘ä»¬å¦‚ä½•è¿›è¡Œè·¯å¾„åˆ‡æ¢

è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š``int chdir(const char *path);`` å¤´æ–‡ä»¶ï¼š``"stdio.h"``

**å‡½æ•°åŸå‹**

```c
int chdir(const char *path);
```

**å‚æ•°**
- `path`ï¼šæŒ‡å‘ä¸€ä¸ªä»¥ null ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ›´æ”¹åˆ°çš„ç›®æ ‡ç›®å½•çš„è·¯å¾„ã€‚

**è¿”å›å€¼**
- å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œè¿”å›Â `0`ã€‚
- å¦‚æœå‡½æ•°æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›Â `-1`Â å¹¶è®¾ç½®Â `errno`Â ä»¥æŒ‡ç¤ºé”™è¯¯åŸå› ã€‚

**è¡Œä¸º**ï¼š
`chdir` å‡½æ•°å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸º `path` æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœ `path` æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå®ƒå°†ç›´æ¥æ›´æ”¹åˆ°è¯¥è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•ã€‚å¦‚æœ `path` æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†æ›´æ”¹åˆ°ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•ã€‚

```c
// è·¯å¾„åˆ‡æ¢å‡½æ•°
void cd(const char *path)
{
    // è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼šint chdir(const char *path); å¤´æ–‡ä»¶ï¼š"stdio.h"
    // chdir å‡½æ•°å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸º path æŒ‡å®šçš„ç›®å½•ã€‚
    //å¦‚æœ path æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå®ƒå°†ç›´æ¥æ›´æ”¹åˆ°è¯¥è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•ã€‚
    //å¦‚æœ path æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†æ›´æ”¹åˆ°ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•
    chdir(path);
}
```

æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// #define Debug 1
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

// æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int execute(char *argv[])
{
    pid_t id = fork();
    if (id < 0)
        return -1;    // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› -1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }

    return 0;
}

// è·¯å¾„åˆ‡æ¢å‡½æ•°
void cd(const char *path)
{
    // è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼šint chdir(const char *path); å¤´æ–‡ä»¶ï¼š"stdio.h"
    // chdir å‡½æ•°å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸º path æŒ‡å®šçš„ç›®å½•ã€‚
    //å¦‚æœ path æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå®ƒå°†ç›´æ¥æ›´æ”¹åˆ°è¯¥è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•ã€‚
    //å¦‚æœ path æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†æ›´æ”¹åˆ°ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„æ‰€è¡¨ç¤ºçš„ç›®å½•
    chdir(path);
}

// 3. æ£€æŸ¥å¯¹åº”çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤, ç”¨ 1 è¡¨ç¤ºæ˜¯å†…å»ºå‘½ï¼Œç”¨ 0 è¡¨ç¤ºä¸æ˜¯å†…å»ºå‘½ä»¤
int doBuildin(char *argv[])
{
    if (strcmp(argv[0], "cd") == 0)
    {
        char *path = NULL;   // å¦‚æœæˆ‘ä»¬ä½¿ç”¨ cd å‘½ä»¤ï¼Œé‚£ä¹ˆåé¢æ˜¯æœ‰è·¯åŠ²çš„ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ pathæ¥è¡¨ç¤º
        if (argv[1] == NULL) // å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥è·¯åŠ²ï¼Œé‚£æˆ‘ä»¬é»˜è®¤æ˜¯å½“å‰è·¯åŠ²ï¼š"."
        {
            path = ".";
        }
        else
        {
            path = argv[1]; // else çš„è¯å°±è¯´æ˜ç”¨æˆ·è¾“å…¥äº†è·¯å¾„
        }

        cd(path);
        return 1; // æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬ return 1ï¼›
    }
    return 0; // ä¸æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬å°±return 0;
}
int main()
{
    while (1)
    {
        char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

        //  1.æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²
        getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        // 2.åˆ†å‰²å‘½ä»¤
        commandSplit(usercommand, argv);
        // 3. æ£€æŸ¥å¯¹åº”çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤
        int n = doBuildin(argv);
        if (n) // å¦‚æœå®ƒæ˜¯å†…å»ºå‘½ä»¤ï¼Œæˆ‘ä»¬æ‰§è¡Œå®ƒä¹‹åï¼Œè·³è¿‡è¿™ä¸ªå¾ªç¯å‰©ä½™çš„éƒ¨åˆ†ï¼Œä¸ç”¨å†å¾€åèµ°äº†
            continue;
        // 4.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
        execute(argv);
    }
    return 0;
}
```


è¿è¡Œä¸Šé¢çš„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥åœ¨è‡ªå®šä¹‰çš„ shellä¸­ è¿›è¡Œè·¯å¾„åˆ‡æ¢äº†

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/3d2bfeb6e7e04899aef021c0ef42fb50.png)


æ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼š

``char cwd[1024] ``è¿™é‡Œé¢å­˜æ”¾çš„æ˜¯å½“å‰å·¥ä½œç›®å½•ï¼Œæ˜¯ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡ä¸èƒ½æ˜¯å­˜æ”¾åœ¨ä¸´æ—¶çš„ç©ºé—´ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå®šä¹‰æˆå…¨å±€å˜é‡
```c
char cwd[1024]; 
// è·¯å¾„åˆ‡æ¢å‡½æ•°
void cd(const char *path)
{
    chdir(path);
    char tmp[1024];
    getcwd(tmp, sizeof(tmp));
    sprintf(cwd, "PWD=%s", tmp); 
    putenv(cwd);
}
```

 å¯¹ä¸Šé¢ä»£ç çš„è§£é‡Šï¼š

1. **å®šä¹‰å…¨å±€å˜é‡ `cwd`**:
   ```c
   char cwd[1024];
   ```
   è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå…¨å±€å­—ç¬¦æ•°ç»„ `cwd`ï¼Œç”¨äºå­˜å‚¨å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚ç”±äºç¯å¢ƒå˜é‡éœ€è¦æŒä¹…å­˜å‚¨ï¼Œæ‰€ä»¥ `cwd` è¢«å®šä¹‰ä¸ºå…¨å±€å˜é‡ï¼Œä»¥ä¾¿åœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹å®ƒã€‚

2. **å®šä¹‰ `cd` å‡½æ•°**:
   ```c
   void cd(const char *path)
   ```
   è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ `cd` å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆ `path` ä½œä¸ºå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯è¦åˆ‡æ¢åˆ°çš„ç›®æ ‡ç›®å½•è·¯å¾„ã€‚

3. **æ›´æ”¹å½“å‰å·¥ä½œç›®å½•**:
   ```c
   chdir(path);
   ```
   ä½¿ç”¨ `chdir` å‡½æ•°å°è¯•æ›´æ”¹å½“å‰å·¥ä½œç›®å½•åˆ° `path` æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœæ›´æ”¹å¤±è´¥ï¼Œ`chdir` ä¼šè¿”å› `-1`.

4. **è·å–å½“å‰å·¥ä½œç›®å½•**:
   ```c
   char tmp[1024];
   getcwd(tmp, sizeof(tmp));
   ```
   å£°æ˜ä¸€ä¸ªä¸´æ—¶æ•°ç»„ `tmp`ï¼Œç„¶åä½¿ç”¨ `getcwd` å‡½æ•°è·å–å½“å‰å·¥ä½œç›®å½•çš„å®Œæ•´è·¯å¾„ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ `tmp` ä¸­ã€‚

5. **æ›´æ–°å…¨å±€å˜é‡ `cwd`**:
   ```c
   sprintf(cwd, "PWD=%s", tmp); 
   ```
   ä½¿ç”¨ `sprintf` å‡½æ•°å°† `tmp` ä¸­çš„è·¯å¾„æ ¼å¼åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å­˜å‚¨åœ¨å…¨å±€å˜é‡ `cwd` ä¸­ã€‚æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²æ˜¯ "PWD=è·¯å¾„"ï¼Œå…¶ä¸­ `PWD` æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºå­˜å‚¨å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚

6. **æ›´æ–°ç¯å¢ƒå˜é‡**:
   ```c
   putenv(cwd);
   ```
   ä½¿ç”¨ `putenv` å‡½æ•°æ›´æ–°ç¯å¢ƒå˜é‡ã€‚`putenv` ä¼šä¿®æ”¹æˆ–æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå®ƒä¼šæ›´æ–° `PWD` ç¯å¢ƒå˜é‡ä¸º `cwd` ä¸­å­˜å‚¨çš„è·¯å¾„ã€‚è¿™æ ·ï¼Œä»»ä½•ä¾èµ–äº `PWD` ç¯å¢ƒå˜é‡çš„ç¨‹åºéƒ½ä¼šçœ‹åˆ°æ›´æ–°åçš„è·¯å¾„ã€‚

è¿™æ®µä»£ç çš„ `cd` å‡½æ•°ä¸ä»…æ›´æ”¹äº†å½“å‰å·¥ä½œç›®å½•ï¼Œè¿˜æ›´æ–°äº† `PWD` ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿å‘½ä»¤è¡Œæç¤ºç¬¦å¯ä»¥æ˜¾ç¤ºæ­£ç¡®çš„å½“å‰å·¥ä½œç›®å½•è·¯å¾„ã€‚

æˆ‘ä»¬ç°åœ¨çš„ä»£ç ï¼š
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define SIZE 64
#define NUM 1024 // è¿™é‡Œå®šä¹‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œæœ€å¤§çš„è¾“å…¥æ˜¯ 1024 ä¸ªå­—èŠ‚
#define SEP " "
// #define Debug 1
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
char cwd[1024]; // è¿™é‡Œé¢å­˜æ”¾çš„æ˜¯å½“å‰å·¥ä½œç›®å½•ï¼Œæ˜¯ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡ä¸èƒ½æ˜¯å­˜æ”¾åœ¨ä¸´æ—¶çš„ç©ºé—´ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå®šä¹‰æˆå…¨å±€å˜é‡

// è·å–å½“å‰çš„ç”¨æˆ·å
const char *getUsername()
{
    const char *name = getenv("USER");
    if (name)
        return name;
    else
        return "none";
}

// è·å–å½“å‰çš„ä¸»æœºå
const char *getHostname()
{
    const char *hostname = getenv("HOSTNAME");
    if (hostname)
        return hostname;
    else
        return "none";
}

// è·å–å½“å‰çš„å·¥ä½œç›®å½•
const char *getCwd()
{
    const char *cwd = getenv("PWD");
    if (cwd)
        return cwd;
    else
        return "none";
}

// è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int getUserCommand(char *command, int num)
{

    printf("[%s@%s %s]ï¿¥", getUsername(), getHostname(), getCwd());
    char *r = fgets(command, num, stdin);
    if (r == NULL)
        return 1; // è·å–å¤±è´¥

    command[strlen(command) - 1] = '\0';
    return 0;
}

// å­—ç¬¦ä¸²çš„åˆ‡å‰²
void commandSplit(char *in, char *out[])
{
    int argc = 0;                  // ç”¨æ¥å­˜å‚¨åˆ†å‰²å¥½ä¹‹åçš„å­—ä¸²çš„ä¸ªæ•°
    out[argc++] = strtok(in, SEP); // ç¬¬ä¸€æ¬¡ä¼ å‚:ä¼ æˆ‘ä»¬è¦åˆ†å‰²çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œ
    while (out[argc++] = strtok(NULL, SEP))
        ;
#ifdef Debug
    // éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†å‰²å¯¹æ²¡æœ‰ï¼š
    for (int i = 0; out[i]; i++)
    {
        printf("%d:%s\n", i, out[i]);
    }
#endif
}

// æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
int execute(char *argv[])
{
    pid_t id = fork();
    if (id < 0)
        return -1;    // å¦‚æœåˆ›å»ºå­è¿›ç¨‹å¤±è´¥å°±è¿”å› -1ï¼›
    else if (id == 0) // id == 0 ,è¯´æ˜æ˜¯å­è¿›ç¨‹
    {
        // exec commmand, è®©å­è¿›ç¨‹è¿›è¡Œç¨‹åºæ›¿æ¢ï¼Œç›®çš„æ˜¯æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
        execvp(argv[0], argv); // æˆ‘ä»¬ä½¿ç”¨æ¥å£ execvp()

        exit(1); // å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ exit æ¥é€€å‡º
    }
    else // è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹
    {
        // çˆ¶è¿›ç¨‹çš„ä½œç”¨æ˜¯ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ï¼šwaitpid,å¤´æ–‡ä»¶æ˜¯ï¼š"sys/types.h" å’Œ â€œsys/wait.hâ€
        pid_t rid = waitpid(id, NULL, 0);
        if (rid > 0) // è¯´æ˜ç­‰å¾…æˆåŠŸäº†
        {
        }
    }

    return 0;
}

// è·¯å¾„åˆ‡æ¢å‡½æ•°
void cd(const char *path)
{
    chdir(path);
    char tmp[1024];
    getcwd(tmp, sizeof(tmp));
    sprintf(cwd, "PWD=%s", tmp); 
    putenv(cwd);
}

// 3. æ£€æŸ¥å¯¹åº”çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤, ç”¨ 1 è¡¨ç¤ºæ˜¯å†…å»ºå‘½ï¼Œç”¨ 0 è¡¨ç¤ºä¸æ˜¯å†…å»ºå‘½ä»¤
int doBuildin(char *argv[])
{
    if (strcmp(argv[0], "cd") == 0)
    {
        char *path = NULL;   // å¦‚æœæˆ‘ä»¬ä½¿ç”¨ cd å‘½ä»¤ï¼Œé‚£ä¹ˆåé¢æ˜¯æœ‰è·¯åŠ²çš„ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ pathæ¥è¡¨ç¤º
        if (argv[1] == NULL) // å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥è·¯åŠ²ï¼Œé‚£æˆ‘ä»¬é»˜è®¤æ˜¯å½“å‰è·¯åŠ²ï¼š"."
        {
            path = ".";
        }
        else
        {
            path = argv[1]; // else çš„è¯å°±è¯´æ˜ç”¨æˆ·è¾“å…¥äº†è·¯å¾„
        }

        cd(path);
        return 1; // æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬ return 1ï¼›
    }
    return 0; // ä¸æ˜¯å†…å»ºå‘½ä»¤æˆ‘ä»¬å°±return 0;
}
int main()
{
    while (1)
    {
        char usercommand[NUM]; // ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        char *argv[SIZE] = {NULL}; // åˆ†é…SIZEä¸ªæŒ‡é’ˆï¼Œåˆå§‹å€¼å‡ä¸ºNULL

        //  1.æ‰“å°æç¤ºç¬¦&&è·å–ç”¨æˆ·å‘½ä»¤å­—ç¬¦ä¸²
        getUserCommand(usercommand, sizeof(usercommand)); // è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤

        // 2.åˆ†å‰²å‘½ä»¤
        commandSplit(usercommand, argv);
        // 3. æ£€æŸ¥å¯¹åº”çš„å‘½ä»¤æ˜¯ä¸æ˜¯å†…å»ºå‘½ä»¤
        int n = doBuildin(argv);
        if (n) // å¦‚æœå®ƒæ˜¯å†…å»ºå‘½ä»¤ï¼Œæˆ‘ä»¬æ‰§è¡Œå®ƒä¹‹åï¼Œè·³è¿‡è¿™ä¸ªå¾ªç¯å‰©ä½™çš„éƒ¨åˆ†ï¼Œä¸ç”¨å†å¾€åèµ°äº†
            continue;
        // 4.æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤
        execute(argv);
    }
    return 0;
}
```

