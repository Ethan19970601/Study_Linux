# 🏷️ 进程终止


## 📌 问题引入？

**我们思考一个问题，我们写 c/c++ 程序的时候，为什么要写一个``return 0`` ？ 不写行不行？如果 return 1，return 2行不行， 这个 ``0`` 是给谁返回的呢？**

如果我们有以下程序：
```c

#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/types.h>

#define N 10

// 下面是一个返回值为 void 参数为空的函数指针
typedef void (*callback_t)();

void worker()

{

int cnt = 10;

while(cnt--)

{

printf("I am child process, pid: %d, ppid: %d, cnt: %d\n", getpid(), getppid(),cnt);

sleep(1);

}

}

  

void creatSubProces(int n, callback_t cb)

{

  sleep(1); 

for (int i = 0; i < N; i++)

{

sleep(1);

printf("creat child process success: %d\n", i);

pid_t pid = fork();

if (pid == 0)

{

// child 说明这是一个子进程

      cb();

exit(0);

}

  }

}

  
int main()

{

  creatSubProces(N,worker);

// for 循环跑完之后，在后续的代码处，就只有父进程了

sleep(100);

return 0;
}
```

我们看到上面``main`` 函数的返回值是``0`` ,如果我们把它改成``10`` ,我们看看会怎样？
> return 10 // return 0 被我们改成了 return 10

我们发现，上面的程序依然能够成功的运行，在liunx 下 运行下面的命令，查看
``echo $?`` 

我们会发现输入上面的命名后屏幕上输出的是 10 。 

## 📌进程退出场景

- 代码运行完毕，结果正确

- 代码运行完毕，结果不正确

- 代码异常终止

所以当我们运行一个程序的时候，结果有上面三种可能，当程序运行完成之后，我们要知道它的状态是怎样的，结果到底是正确的还是不正确的？

如果你创建了一个子进程，那父进程也会想要知道子进程运行的结果如何,那我们如何知道这个结果呢？所以就有了``main`` 函数的返回值，``main`` 函数的返回值又叫进程的退出码 ，``0`` 通常表示 ``success``, ``非 0`` 通常表示的是``failed``, 同时，不同的非 0 数字也可以用来表示不同的出错原因，C语言也内置了一些错误码系统也为我们提供了相应的接口：``strerror``  

上面提到的``$?`` 其实就是保存的最近一个子进程退出时保存的退出码

**根据不同的现象返回不同的退出码** 

**📎 错误码和退出码的关系** 

> [!NOTE] 错误码
>  错误码通常是衡量一个库函数或者是一个系统调用一个函数的调用情况

> [!NOTE] 退出码
>  退出码通常是一个进程退出的时候，他的退出结果

他们两个虽然概念上有不同，但是目的都是想要弄明白出错的原因，错误码是想弄明白函数出错的原因，退出码是想弄明白进程出错的原因。

如果一个进程是因为代码异常而终止的，那这个进程有没有跑完，它的退出码还有意义吗？
答, 一旦你的进程出问题了，你的代码一般是没跑完的。其实当我们的代码出问题了，它的退出码是没有意义的。举一个形象的例子：张三考试作弊得了 100 分，但是被发现了。学校会这样做吗：通报批评张三，然后表杨他考了 100 分。显然不会，学校只会通报批评，同样，进程异常了，我们也不会去关心它的退出码了（类比我们不会去表杨张三考了 100 分。）

什么情况下是代码异常，代码异常的本质是什么？

## 📌 异常问题---引入一下

我们知道想要终止一个进程可以使用快捷键``ctrl c`` ， 也可以使用命令``kill -9`` 来杀掉它
你可以随意运行一个正常的无错误的代码，然后以 ``kill -11 (该进程的 pid)`` 来杀掉他，``-11`` 表示 的该进程有段错误，然后这个进程就被终止了，并显示有段错误（这就是欲加之罪）

进程出异常 本质上是进程受到了对应的信号，自己终止了！！

进程终止是因为收到了信号，所以我们确定进程是否受异常，我们需要做的事就是检测有没有收到信号即可。

0 表示的是没有收到信号，非 0 表示的是收到了信号

